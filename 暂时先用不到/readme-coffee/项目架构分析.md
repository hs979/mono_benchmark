# Serverlesspresso é¡¹ç›®æ¶æ„åˆ†æ

## é¡¹ç›®ç®€ä»‹
è¿™æ˜¯ä¸€ä¸ªAWSä¸Šçš„Serverlesså’–å•¡è®¢è´­åº”ç”¨åç«¯ç³»ç»Ÿ,é‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„(EDA),ä½¿ç”¨å¤šä¸ªå¾®æœåŠ¡å¤„ç†å’–å•¡è®¢å•çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚

---

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶ç»“æ„(å¿…é¡»ä¿ç•™)

### 1. åŸºç¡€æ ¸å¿ƒè®¾æ–½ - `00-baseCore/`
**é‡è¦æ€§**: â­â­â­â­â­ (æœ€é«˜ä¼˜å…ˆçº§)

è¿™æ˜¯æ•´ä¸ªåº”ç”¨çš„åŸºç¡€è®¾æ–½å±‚,æä¾›æ ¸å¿ƒæœåŠ¡æ”¯æ’‘ã€‚

**æ ¸å¿ƒæ–‡ä»¶**:
- `template.yaml` - CloudFormationæ¨¡æ¿,å®šä¹‰åŸºç¡€è®¾æ–½
  - EventBridgeè‡ªå®šä¹‰äº‹ä»¶æ€»çº¿ (Serverlesspresso)
  - Cognitoç”¨æˆ·æ± å’Œèº«ä»½æ± (ç”¨æˆ·è®¤è¯)
  - IoT Coreå®æ—¶æ¶ˆæ¯æœåŠ¡
  - CloudWatchæ—¥å¿—ç»„

- `cognito-triggers/` - ç”¨æˆ·è®¤è¯è§¦å‘å™¨
  - `define-auth-challenge.js` - å®šä¹‰è®¤è¯æŒ‘æˆ˜
  - `create-auth-challenge.js` - åˆ›å»ºè®¤è¯æŒ‘æˆ˜(å‘é€çŸ­ä¿¡éªŒè¯ç )
  - `verify-auth-challenge-response.js` - éªŒè¯ç”¨æˆ·å“åº”
  - `pre-sign-up.js` - ç”¨æˆ·æ³¨å†Œå‰å¤„ç†
  - `package.json` - ä¾èµ–é…ç½®

- `GetIoTEndpoint.js` - è·å–IoTç«¯ç‚¹åœ°å€
- `export.json` - å¯¼å‡ºé…ç½®
- `output.yaml` - è¾“å‡ºé…ç½®

**ä½œç”¨**: æä¾›ç”¨æˆ·è®¤è¯ã€äº‹ä»¶æ€»çº¿ã€å®æ—¶é€šä¿¡ç­‰åŸºç¡€èƒ½åŠ›

---

### 2. åº”ç”¨æ ¸å¿ƒ - `01-appCore/`
**é‡è¦æ€§**: â­â­â­â­â­ (æœ€é«˜ä¼˜å…ˆçº§)

è¿™æ˜¯åº”ç”¨çš„ä¸»è¦ä¸šåŠ¡é€»è¾‘å±‚,æ•´åˆäº†æ‰€æœ‰å¾®æœåŠ¡ã€‚

**æ ¸å¿ƒæ–‡ä»¶**:
- `template.yaml` - ä¸»åº”ç”¨æ¨¡æ¿,åŒ…å«:
  - æ‰€æœ‰DynamoDBè¡¨å®šä¹‰
  - æ‰€æœ‰Lambdaå‡½æ•°å®šä¹‰
  - Step FunctionsçŠ¶æ€æœº
  - API Gateway REST APIs
  - IAMè§’è‰²å’Œç­–ç•¥

- `initDB/` - æ•°æ®åº“åˆå§‹åŒ–
  - `app.js` - åˆå§‹åŒ–Lambdaå‡½æ•°
  - `initMenu.js` - åˆå§‹åŒ–èœå•æ•°æ®
  - `initMenuState.JSON` - èœå•åˆå§‹çŠ¶æ€
  - `initCountingState.JSON` - è®¡æ•°å™¨åˆå§‹çŠ¶æ€
  - `package.JSON` - ä¾èµ–é…ç½®

**ä½œç”¨**: æ•´åˆæ‰€æœ‰æœåŠ¡,ç®¡ç†åº”ç”¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

---

### 3. åç«¯å¾®æœåŠ¡ - `backends/`

#### 3.1 è®¡æ•°æœåŠ¡ - `1-counting-service/`
**é‡è¦æ€§**: â­â­â­â­
- `getOrderId.js` - è·å–è®¢å•ID
- `resetOrderId.js` - é‡ç½®è®¢å•IDè®¡æ•°å™¨
- `package.json`

**ä½œç”¨**: ä¸ºæ¯ä¸ªè®¢å•ç”Ÿæˆå”¯ä¸€çš„é€’å¢ID

---

#### 3.2 é…ç½®æœåŠ¡ - `2-config-service/`
**é‡è¦æ€§**: â­â­â­â­â­
- `code/configChanged.js` - ç›‘å¬é…ç½®å˜æ›´å¹¶å‘å¸ƒäº‹ä»¶
- `code/package.json`
- `RestAPIs/api.yaml` - REST APIå®šä¹‰

**ä½œç”¨**: ç®¡ç†åº”ç”¨é…ç½®(å¦‚å•†åº—è¥ä¸šçŠ¶æ€ã€èœå•ç­‰),é…ç½®å˜æ›´æ—¶é€šçŸ¥å…¶ä»–æœåŠ¡

---

#### 3.3 è®¢å•å¤„ç†æœåŠ¡ - `4-order-processing/`
**é‡è¦æ€§**: â­â­â­â­â­
- `statemachine/op.asl.json` - Step Functionså·¥ä½œæµå®šä¹‰
- `functions/capacity/isCapacityAvailable.js` - æ£€æŸ¥äº§èƒ½
- `api.yaml` - APIå®šä¹‰

**ä½œç”¨**: åè°ƒè®¢å•å¤„ç†æµç¨‹,åŒ…æ‹¬äº§èƒ½æ£€æŸ¥ã€è¶…æ—¶å¤„ç†ç­‰

---

#### 3.4 è®¢å•ç®¡ç†æœåŠ¡ - `5-order-manager/`
**é‡è¦æ€§**: â­â­â­â­â­
- `statemachine/om.asl.json` - è®¢å•ç®¡ç†å·¥ä½œæµ
- `functions/sanitize/app.js` - è®¢å•æ•°æ®æ¸…æ´—
- `functions/workflowStarted/app.js` - å·¥ä½œæµå¯åŠ¨å¤„ç†
- `functions/waitingCompletion/app.js` - ç­‰å¾…å®Œæˆå¤„ç†
- `functions/OrderTimedOut/app.js` - è®¢å•è¶…æ—¶å¤„ç†
- `RestAPIs/api.yaml` - REST APIå®šä¹‰
- `robot/` - æœºå™¨äººæ¨¡æ‹Ÿ(ç”¨äºæµ‹è¯•)

**ä½œç”¨**: ç®¡ç†è®¢å•ç”Ÿå‘½å‘¨æœŸ,å¤„ç†è®¢å•çŠ¶æ€å˜æ›´,æä¾›è®¢å•æŸ¥è¯¢API

---

#### 3.5 å‘å¸ƒæœåŠ¡ - `6-publisher-service/`
**é‡è¦æ€§**: â­â­â­â­â­
- `publishToIOT.js` - å‘å¸ƒåˆ°IoTç®¡ç†å‘˜ä¸»é¢˜
- `publishToIOTconfig.js` - å‘å¸ƒé…ç½®æ›´æ–°
- `publishToIOTuserTopic.js` - å‘å¸ƒåˆ°ç”¨æˆ·ä¸»é¢˜
- `package.json`

**ä½œç”¨**: é€šè¿‡IoT Coreå‘å‰ç«¯åº”ç”¨æ¨é€å®æ—¶æ›´æ–°(è®¢å•çŠ¶æ€ã€é…ç½®å˜æ›´ç­‰)

---

#### 3.6 æŒ‡æ ‡æœåŠ¡ - `7-metrics-service/`
**é‡è¦æ€§**: â­â­â­ (å¯é€‰,ç”¨äºç›‘æ§)
- `OrderManagerOrderCancelled.js` - è®¢å•å–æ¶ˆæŒ‡æ ‡
- `OrderManagerWaitingCompletion.js` - ç­‰å¾…å®ŒæˆæŒ‡æ ‡
- `OrderProcessorOrderTimeOut.js` - è®¢å•è¶…æ—¶æŒ‡æ ‡
- `ValidatorNewOrder.js` - æ–°è®¢å•æŒ‡æ ‡
- `template.yaml`
- `package.json`

**ä½œç”¨**: æ”¶é›†å’Œå‘å¸ƒä¸šåŠ¡æŒ‡æ ‡åˆ°CloudWatch

---

#### 3.7 è®¢å•æ—…ç¨‹æœåŠ¡ - `8-order-journey/`
**é‡è¦æ€§**: â­â­â­ (å¢å¼ºåŠŸèƒ½)
- `statemachine/StepFunction.asl.json` - è®¢å•æ—…ç¨‹å·¥ä½œæµ
- `functions/GenerateHtml/app.js` - ç”Ÿæˆè®¢å•æ—…ç¨‹HTMLé¡µé¢
- `functions/GenerateHtml/fa.css` - æ ·å¼æ–‡ä»¶
- `functions/GenerateHtml/script.js` - è„šæœ¬æ–‡ä»¶
- `template.yaml`

**ä½œç”¨**: ä¸ºæ¯ä¸ªè®¢å•ç”Ÿæˆå¯è§†åŒ–çš„è®¢å•æ—…ç¨‹é¡µé¢,å­˜å‚¨åœ¨S3å¹¶é€šè¿‡CloudFrontåˆ†å‘

---

#### 3.8 éªŒè¯æœåŠ¡ - `9-validator/`
**é‡è¦æ€§**: â­â­â­â­â­
- `getCode.js` - ç”ŸæˆéªŒè¯äºŒç»´ç 
- `verifyCode.js` - éªŒè¯äºŒç»´ç 
- `ddb.js` - DynamoDBæ“ä½œ
- `package.json`
- `template.yaml`

**ä½œç”¨**: å¤„ç†è®¢å•éªŒè¯ç ç”Ÿæˆå’ŒéªŒè¯,è¿æ¥é¡¾å®¢åº”ç”¨å’Œå’–å•¡å¸ˆåº”ç”¨

---

## âŒ å¯ä»¥åˆ é™¤çš„æ–‡ä»¶(éæ ¸å¿ƒ)

### 1. æ‰©å±•åŠŸèƒ½ - `extensions/` ç›®å½•
**å¯åˆ é™¤**: âœ… å®Œå…¨å¯ä»¥åˆ é™¤

è¿™ä¸ªç›®å½•åŒ…å«çš„æ˜¯æ¼”ç¤ºæ€§çš„æ‰©å±•åŠŸèƒ½,ä¸æ˜¯æ ¸å¿ƒåº”ç”¨çš„ä¸€éƒ¨åˆ†:
- `_extension-model/` - æ‰©å±•æ¨¡æ¿ç¤ºä¾‹
- `EventPlayer/` - äº‹ä»¶é‡æ”¾å™¨(ç”¨äºæµ‹è¯•)
- `OrderRobotExtension/` - æœºå™¨äººè‡ªåŠ¨å¤„ç†æ‰©å±•
- `PersistOrderMetricsToDynamoDB/` - æŒä¹…åŒ–æŒ‡æ ‡æ‰©å±•
- `WaitTimes/` - ç­‰å¾…æ—¶é—´åˆ†ææ‰©å±•
- `README.md` å’Œèµ„æºæ–‡ä»¶

**è¯´æ˜**: è¿™äº›æ˜¯å±•ç¤ºå¦‚ä½•æ‰©å±•åº”ç”¨çš„ç¤ºä¾‹,åˆ é™¤ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

---

### 2. æµ‹è¯•æ–‡ä»¶
**å¯åˆ é™¤**: âœ… ç”Ÿäº§ç¯å¢ƒå¯ä»¥åˆ é™¤

ä»¥ä¸‹æµ‹è¯•ç›¸å…³æ–‡ä»¶åœ¨ç”Ÿäº§éƒ¨ç½²æ—¶å¯ä»¥åˆ é™¤:
- æ‰€æœ‰ `localTest.js` æ–‡ä»¶
- æ‰€æœ‰ `testharness.js` æ–‡ä»¶
- æ‰€æœ‰ `test/` å’Œ `tests/` ç›®å½•
- æ‰€æœ‰ `events/` ç›®å½•ä¸­çš„æµ‹è¯•äº‹ä»¶JSONæ–‡ä»¶
- `backends/4-order-processing/functions/env.json`

**è¯´æ˜**: è¿™äº›æ–‡ä»¶ä»…ç”¨äºæœ¬åœ°å¼€å‘å’Œæµ‹è¯•

---

### 3. æ–‡æ¡£å’Œèµ„æºæ–‡ä»¶
**å¯åˆ é™¤**: âœ… éƒ¨åˆ†å¯åˆ é™¤(å»ºè®®ä¿ç•™README)

- `CODE_OF_CONDUCT.md` - è¡Œä¸ºå‡†åˆ™(å¼€æºé¡¹ç›®ç®¡ç†)
- `CONTRIBUTING.md` - è´¡çŒ®æŒ‡å—(å¼€æºé¡¹ç›®ç®¡ç†)
- `PUBLISHING.md` - å‘å¸ƒæŒ‡å—
- `LICENSE` - è®¸å¯è¯(å»ºè®®ä¿ç•™)
- `docs/PULL_REQUEST_TEMPLATE.md` - PRæ¨¡æ¿
- `backends/4-order-processing/repo-resources/` - ä»“åº“èµ„æºå›¾ç‰‡
- `backends/4-order-processing/README.md` - æœåŠ¡è¯´æ˜æ–‡æ¡£
- `backends/8-order-journey/README.md` - æœåŠ¡è¯´æ˜æ–‡æ¡£

**è¯´æ˜**: è¿™äº›ä¸»è¦æ˜¯å¼€æºé¡¹ç›®ç®¡ç†å’Œè¯´æ˜æ–‡æ¡£,å¯¹åº”ç”¨è¿è¡Œæ²¡æœ‰å½±å“

---

### 4. è¾“å‡ºæ–‡ä»¶
**å¯åˆ é™¤**: âœ… å¯ä»¥åˆ é™¤

- `00-baseCore/output.yaml`
- `00-baseCore/export.json`
- `01-appCore/output.yaml`
- `01-appCore/export.json`

**è¯´æ˜**: è¿™äº›æ˜¯SAM CLIéƒ¨ç½²åç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶,å¯ä»¥é‡æ–°ç”Ÿæˆ

---

### 5. æœºå™¨äººæµ‹è¯•è„šæœ¬
**å¯åˆ é™¤**: âœ… å¯ä»¥åˆ é™¤

- `backends/5-order-manager/robot/` - è®¢å•æœºå™¨äººæµ‹è¯•è„šæœ¬
- `backends/scripts/stopRunningExecutions.js` - åœæ­¢è¿è¡Œçš„æ‰§è¡Œè„šæœ¬

**è¯´æ˜**: ä»…ç”¨äºæµ‹è¯•å’Œæ¼”ç¤º

---

## ğŸ“Š æœåŠ¡ä¾èµ–å…³ç³»

```
EventBridgeäº‹ä»¶æ€»çº¿ (00-baseCore)
    â†“
    â”œâ”€â†’ ValidatoræœåŠ¡ (éªŒè¯è®¢å•)
    â”‚      â†“
    â”‚   OrderProcessor (å¤„ç†è®¢å•)
    â”‚      â†“
    â”‚   OrderManager (ç®¡ç†è®¢å•çŠ¶æ€)
    â”‚      â†“
    â”œâ”€â†’ PublisheræœåŠ¡ (æ¨é€å®æ—¶æ›´æ–°)
    â”œâ”€â†’ MetricsæœåŠ¡ (æ”¶é›†æŒ‡æ ‡)
    â””â”€â†’ OrderJourneyæœåŠ¡ (ç”Ÿæˆè®¢å•æ—…ç¨‹)

é…ç½®æœåŠ¡ â†â†’ æ‰€æœ‰å…¶ä»–æœåŠ¡ (æä¾›é…ç½®ä¿¡æ¯)
è®¡æ•°æœåŠ¡ â† OrderProcessor (æä¾›è®¢å•ID)
```

---

## ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **è®¡ç®—**: AWS Lambda (Node.js 14)
- **ç¼–æ’**: AWS Step Functions
- **API**: Amazon API Gateway (REST API)
- **æ•°æ®åº“**: Amazon DynamoDB
- **æ¶ˆæ¯**: Amazon EventBridge + AWS IoT Core
- **è®¤è¯**: Amazon Cognito
- **å­˜å‚¨**: Amazon S3
- **åˆ†å‘**: Amazon CloudFront
- **ç›‘æ§**: Amazon CloudWatch
- **IaC**: AWS SAM (Serverless Application Model)

---

## ğŸ“¦ éƒ¨ç½²é¡ºåº

1. **ç¬¬ä¸€æ­¥**: éƒ¨ç½²åŸºç¡€æ ¸å¿ƒ
   ```bash
   cd 00-baseCore
   sam build
   sam deploy --guided
   ```

2. **ç¬¬äºŒæ­¥**: éƒ¨ç½²åº”ç”¨æ ¸å¿ƒ
   ```bash
   cd 01-appCore
   sam build
   sam deploy --guided
   ```

3. **å¯é€‰**: éƒ¨ç½²æ‰©å±•åŠŸèƒ½(extensionsç›®å½•)

---

## ğŸ’¡ ç²¾ç®€å»ºè®®

å¦‚æœéœ€è¦æœ€å°åŒ–éƒ¨ç½²,å¯ä»¥è€ƒè™‘åˆ é™¤ä»¥ä¸‹æœåŠ¡(ä¼šå½±å“éƒ¨åˆ†åŠŸèƒ½):

### å¯é€‰æœåŠ¡(åˆ é™¤ååŸºæœ¬åŠŸèƒ½ä»å¯è¿è¡Œ):
1. **MetricsæœåŠ¡** (7-metrics-service) - ä¸å½±å“è®¢å•å¤„ç†,åªæ˜¯æ²¡æœ‰æŒ‡æ ‡
2. **OrderJourneyæœåŠ¡** (8-order-journey) - ä¸å½±å“è®¢å•å¤„ç†,åªæ˜¯æ²¡æœ‰å¯è§†åŒ–æ—…ç¨‹é¡µé¢

### å¿…é¡»ä¿ç•™çš„æ ¸å¿ƒæœåŠ¡:
- ConfigæœåŠ¡ (é…ç½®ç®¡ç†)
- ValidatoræœåŠ¡ (è®¢å•éªŒè¯)
- OrderProcessoræœåŠ¡ (è®¢å•å¤„ç†)
- OrderManageræœåŠ¡ (è®¢å•ç®¡ç†)
- PublisheræœåŠ¡ (å®æ—¶é€šçŸ¥)
- CountingæœåŠ¡ (è®¢å•ç¼–å·)

---

## ğŸ“ æ€»ç»“

**æ ¸å¿ƒæ–‡ä»¶å¤§çº¦å æ¯”**: 70%
- `00-baseCore/` å’Œ `01-appCore/` - å®Œå…¨æ ¸å¿ƒ
- `backends/` çš„ 1,2,4,5,6,9 å·æœåŠ¡ - æ ¸å¿ƒæœåŠ¡
- `backends/` çš„ 7,8 å·æœåŠ¡ - å¢å¼ºæœåŠ¡

**å¯åˆ é™¤æ–‡ä»¶å¤§çº¦å æ¯”**: 30%
- æ•´ä¸ª `extensions/` ç›®å½•
- æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å’Œæµ‹è¯•æ•°æ®
- å¤§éƒ¨åˆ†æ–‡æ¡£æ–‡ä»¶(é™¤äº†ä¸»README)
- æœºå™¨äººå’Œè„šæœ¬å·¥å…·

åˆ é™¤è¿™äº›æ–‡ä»¶å,åº”ç”¨çš„æ ¸å¿ƒè®¢å•å¤„ç†åŠŸèƒ½å®Œå…¨ä¸å—å½±å“!


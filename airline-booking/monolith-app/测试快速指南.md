# èˆªç­é¢„è®¢ç³»ç»Ÿ - æµ‹è¯•å¿«é€ŸæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

**æ— éœ€å¯åŠ¨æœåŠ¡å™¨ï¼Œç›´æ¥æµ‹è¯•æ‰€æœ‰ä¸šåŠ¡é€»è¾‘**

```bash
cd monolith-app
python test_all_business_logic.py
```

**æµ‹è¯•å†…å®¹ï¼š**
- âœ… 7ä¸ªä¸šåŠ¡æ¨¡å—
- âœ… 41ä¸ªæµ‹è¯•ç”¨ä¾‹
- âœ… æ¶µç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- â±ï¸ è¿è¡Œæ—¶é—´: ~2ç§’

**é¢„æœŸè¾“å‡ºï¼š**
```
======================================================================
èˆªç­é¢„è®¢ç³»ç»Ÿ - å®Œæ•´ä¸šåŠ¡é€»è¾‘æµ‹è¯•å¥—ä»¶
======================================================================

æµ‹è¯•æ¨¡å— 1: è®¤è¯æœåŠ¡ (Auth Service)
âœ“ 1.1 ç”¨æˆ·æ³¨å†Œ - æˆåŠŸåˆ›å»ºæ–°ç”¨æˆ·
âœ“ 1.2 é‡å¤æ³¨å†Œæ£€æµ‹ - æ­£ç¡®æ‹’ç»é‡å¤é‚®ç®±
...

æµ‹è¯•æ€»ç»“: 41/41 é€šè¿‡
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!
```

---

### æ–¹æ³• 2: APIç«¯ç‚¹æµ‹è¯•

**éœ€è¦å…ˆå¯åŠ¨æœåŠ¡å™¨ï¼Œæµ‹è¯•HTTP API**

**ç»ˆç«¯ 1 - å¯åŠ¨æœåŠ¡å™¨ï¼š**
```bash
cd monolith-app
python run.py
```

**ç»ˆç«¯ 2 - è¿è¡ŒAPIæµ‹è¯•ï¼š**
```bash
cd monolith-app
python test_api_endpoints.py
```

**æµ‹è¯•å†…å®¹ï¼š**
- âœ… è®¤è¯API (7ä¸ªæµ‹è¯•)
- âœ… èˆªç­ç›®å½•API (6ä¸ªæµ‹è¯•)
- âœ… é¢„è®¢ç®¡ç†API (6ä¸ªæµ‹è¯•)
- âœ… æ”¯ä»˜å¤„ç†API (4ä¸ªæµ‹è¯•)
- âœ… ä¼šå‘˜ç§¯åˆ†API (5ä¸ªæµ‹è¯•)
- â±ï¸ è¿è¡Œæ—¶é—´: ~5ç§’

---

### æ–¹æ³• 3: æ‰‹åŠ¨curlæµ‹è¯•

**é€‚åˆå•ç‹¬æµ‹è¯•æŸä¸ªåŠŸèƒ½**

#### å¿«é€Ÿæµ‹è¯•æµç¨‹ï¼š

```bash
# 1. å¯åŠ¨æœåŠ¡å™¨ï¼ˆåœ¨ä¸€ä¸ªç»ˆç«¯ï¼‰
python run.py

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

# ç™»å½•è·å–ä»¤ç‰Œ
TOKEN=$(curl -s -X POST http://localhost:5000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}' \
  | grep -o '"access_token":"[^"]*"' | cut -d'"' -f4)

echo "Token: $TOKEN"

# æœç´¢èˆªç­
curl "http://localhost:5000/flights/search?departureCode=LAX&arrivalCode=SFO&departureDate=2025-11-10"

# åˆ›å»ºé¢„è®¢
curl -X POST http://localhost:5000/bookings \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"outboundFlightId": "FL001", "chargeId": "ch_test_123"}'
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–å¯¹æ¯”

| æµ‹è¯•æ–¹æ³• | ä¼˜ç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| **ä¸šåŠ¡é€»è¾‘æµ‹è¯•** | âœ… æ— éœ€å¯åŠ¨æœåŠ¡å™¨<br>âœ… è¿è¡Œé€Ÿåº¦å¿«<br>âœ… è¦†ç›–å®Œæ•´<br>âœ… é€‚åˆå¼€å‘é˜¶æ®µ | å¼€å‘æ–°åŠŸèƒ½ã€é‡æ„ä»£ç ã€å¿«é€ŸéªŒè¯ |
| **APIç«¯ç‚¹æµ‹è¯•** | âœ… æµ‹è¯•HTTPå±‚<br>âœ… æµ‹è¯•è®¤è¯æˆæƒ<br>âœ… è‡ªåŠ¨åŒ–å®Œæ•´ | é›†æˆæµ‹è¯•ã€éƒ¨ç½²å‰éªŒè¯ |
| **æ‰‹åŠ¨curlæµ‹è¯•** | âœ… çµæ´»æ§åˆ¶<br>âœ… æ˜“äºè°ƒè¯•<br>âœ… å¯å¤åˆ¶åˆ°æ–‡æ¡£ | é—®é¢˜æ’æŸ¥ã€APIæ¼”ç¤º |

---

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ¨¡å—

### 1. è®¤è¯æœåŠ¡ (`services/auth.py`)
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- JWTä»¤ç‰Œç®¡ç†
- æƒé™æ§åˆ¶ï¼ˆOwner/Adminï¼‰

**æµ‹è¯•é‡ç‚¹ï¼š**
```python
from services.auth import AuthService

# æ³¨å†Œç”¨æˆ·
user = AuthService.register_user("test@example.com", "password123")

# ç™»å½•
user = AuthService.authenticate_user("test@example.com", "password123")

# ç”Ÿæˆä»¤ç‰Œ
token = AuthService.create_access_token(user)

# éªŒè¯ä»¤ç‰Œ
decoded = AuthService.verify_token(token)
```

---

### 2. èˆªç­ç›®å½•æœåŠ¡ (`services/catalog.py`)
- æœç´¢èˆªç­
- åº§ä½é¢„è®¢å’Œé‡Šæ”¾

**æµ‹è¯•é‡ç‚¹ï¼š**
```python
from services.catalog import CatalogService

# æœç´¢èˆªç­
flights = CatalogService.search_flights("LAX", "SFO", "2025-11-10")

# è·å–è¯¦æƒ…
flight = CatalogService.get_flight("FL001")

# é¢„è®¢åº§ä½
CatalogService.reserve_flight_seat("FL001")

# é‡Šæ”¾åº§ä½
CatalogService.release_flight_seat("FL001")
```

---

### 3. é¢„è®¢æœåŠ¡ (`services/booking.py`)
- åˆ›å»ºã€ç¡®è®¤ã€å–æ¶ˆé¢„è®¢
- æŸ¥è¯¢å®¢æˆ·é¢„è®¢

**æµ‹è¯•é‡ç‚¹ï¼š**
```python
from services.booking import BookingService

# åˆ›å»ºé¢„è®¢
booking_data = {
    'outboundFlightId': 'FL001',
    'customerId': 'customer123',
    'chargeId': 'ch_test_123'
}
booking_id = BookingService.reserve_booking(booking_data)

# ç¡®è®¤é¢„è®¢
reference = BookingService.confirm_booking(booking_id)

# æŸ¥è¯¢é¢„è®¢
booking = BookingService.get_booking(booking_id)

# å–æ¶ˆé¢„è®¢
BookingService.cancel_booking(booking_id)

# æŸ¥è¯¢å®¢æˆ·çš„æ‰€æœ‰é¢„è®¢
bookings = BookingService.get_customer_bookings('customer123')
```

---

### 4. æ”¯ä»˜æœåŠ¡ (`services/payment.py`)
- æ”¶æ¬¾å’Œé€€æ¬¾
- æ”¯æŒStripeé›†æˆæˆ–æ¨¡æ‹Ÿæ¨¡å¼

**æµ‹è¯•é‡ç‚¹ï¼š**
```python
from services.payment import PaymentService

# æ”¶æ¬¾
payment = PaymentService.collect_payment("ch_test_123")

# é€€æ¬¾
refund = PaymentService.refund_payment("ch_test_123")

# æŸ¥è¯¢
payment = PaymentService.get_payment("ch_test_123")
```

---

### 5. ä¼šå‘˜ç§¯åˆ†æœåŠ¡ (`services/loyalty.py`)
- ç§¯åˆ†ç®¡ç†
- ç­‰çº§ç³»ç»Ÿï¼ˆé“œã€é“¶ã€é‡‘ï¼‰

**æµ‹è¯•é‡ç‚¹ï¼š**
```python
from services.loyalty import LoyaltyService

# æŸ¥è¯¢ç§¯åˆ†
loyalty = LoyaltyService.get_customer_loyalty("customer123")
# è¿”å›: {'points': 0, 'level': 'bronze', 'remainingPoints': 50000}

# æ·»åŠ ç§¯åˆ†
LoyaltyService.add_loyalty_points("customer123", 1000)

# å¤„ç†é¢„è®¢ç§¯åˆ†
LoyaltyService.process_booking_loyalty("customer123", 150.0)
```

---

### 6. å®Œæ•´é¢„è®¢æµç¨‹

**ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆåœ¨ `app.py` ä¸­å®ç°ï¼‰ï¼š**

```
1. é¢„è®¢åº§ä½ â†’ 2. åˆ›å»ºé¢„è®¢ â†’ 3. å¤„ç†ä»˜æ¬¾ â†’ 4. ç¡®è®¤é¢„è®¢ â†’ 5. æ·»åŠ ç§¯åˆ† â†’ 6. å‘é€é€šçŸ¥
```

**åŒ…å«å®Œæ•´çš„å›æ»šæœºåˆ¶ï¼š**
- å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»šä¹‹å‰çš„æ‰€æœ‰æ“ä½œ
- ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

---

## ğŸ§ª æµ‹è¯•åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1: æ–°ç”¨æˆ·é¦–æ¬¡é¢„è®¢

```bash
# 1. æ³¨å†Œ
curl -X POST http://localhost:5000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email": "newuser@example.com", "password": "pass123"}'

# 2. ç™»å½•
TOKEN=$(curl -s -X POST http://localhost:5000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "newuser@example.com", "password": "pass123"}' \
  | grep -o '"access_token":"[^"]*"' | cut -d'"' -f4)

# 3. æœç´¢èˆªç­
curl "http://localhost:5000/flights/search?departureCode=LAX&arrivalCode=SFO&departureDate=2025-11-10"

# 4. åˆ›å»ºé¢„è®¢
curl -X POST http://localhost:5000/bookings \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"outboundFlightId": "FL001", "chargeId": "ch_new_user_123"}'

# 5. æŸ¥çœ‹ç§¯åˆ†
USER_ID=$(curl -s http://localhost:5000/auth/me -H "Authorization: Bearer $TOKEN" \
  | grep -o '"sub":"[^"]*"' | cut -d'"' -f4)

curl http://localhost:5000/loyalty/$USER_ID -H "Authorization: Bearer $TOKEN"
```

---

### åœºæ™¯ 2: å–æ¶ˆé¢„è®¢å¹¶é€€æ¬¾

```bash
# å‡è®¾å·²æœ‰TOKENå’ŒBOOKING_ID

# 1. æŸ¥çœ‹é¢„è®¢çŠ¶æ€
curl http://localhost:5000/bookings/$BOOKING_ID \
  -H "Authorization: Bearer $TOKEN"

# 2. å–æ¶ˆé¢„è®¢ï¼ˆè‡ªåŠ¨é€€æ¬¾å’Œé‡Šæ”¾åº§ä½ï¼‰
curl -X POST http://localhost:5000/bookings/$BOOKING_ID/cancel \
  -H "Authorization: Bearer $TOKEN"

# 3. éªŒè¯çŠ¶æ€
curl http://localhost:5000/bookings/$BOOKING_ID \
  -H "Authorization: Bearer $TOKEN"
```

---

### åœºæ™¯ 3: ç®¡ç†å‘˜æ“ä½œ

```bash
# 1. ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•
ADMIN_TOKEN=$(curl -s -X POST http://localhost:5000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@example.com", "password": "admin123"}' \
  | grep -o '"access_token":"[^"]*"' | cut -d'"' -f4)

# 2. åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
curl http://localhost:5000/auth/users \
  -H "Authorization: Bearer $ADMIN_TOKEN"

# 3. æ‰‹åŠ¨æ·»åŠ ç§¯åˆ†
curl -X POST http://localhost:5000/loyalty/user123/points \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"points": 5000}'
```

---

## ğŸ› è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜

**1. "Connection refused" é”™è¯¯**
```bash
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
curl http://localhost:5000/api

# å¦‚æœå¤±è´¥ï¼Œå¯åŠ¨æœåŠ¡å™¨
python run.py
```

**2. "401 Unauthorized" é”™è¯¯**
```bash
# é‡æ–°ç™»å½•è·å–æ–°ä»¤ç‰Œ
TOKEN=$(curl -s -X POST http://localhost:5000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}' \
  | grep -o '"access_token":"[^"]*"' | cut -d'"' -f4)
```

**3. "Flight fully booked" é”™è¯¯**
```bash
# é‡å¯æœåŠ¡å™¨é‡ç½®æ•°æ®
# Ctrl+C åœæ­¢æœåŠ¡å™¨
python run.py
```

**4. ä¸šåŠ¡é€»è¾‘æµ‹è¯•å¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
python test_all_business_logic.py

# å¦‚æœæ˜¯å¯¼å…¥é”™è¯¯ï¼Œæ£€æŸ¥å½“å‰ç›®å½•
pwd
# åº”è¯¥åœ¨ monolith-app ç›®å½•ä¸‹
```

---

## ğŸ“ æµ‹è¯•æ•°æ®å‚è€ƒ

### é¢„è£…èˆªç­
- **FL001**: LAX â†’ SFO, 2025-11-10, $150, 100åº§ä½
- **FL002**: JFK â†’ LAX, 2025-11-12, $300, 150åº§ä½

### é¢„è£…ç”¨æˆ·
- **æ™®é€šç”¨æˆ·**: user@example.com / password123
- **ç®¡ç†å‘˜**: admin@example.com / admin123

### ä¼šå‘˜ç­‰çº§
- **é“œå¡**: 1-49,999 ç§¯åˆ†
- **é“¶å¡**: 50,000-99,999 ç§¯åˆ†
- **é‡‘å¡**: 100,000+ ç§¯åˆ†

---

## ğŸ“ æ€»ç»“

### æ¨èçš„æµ‹è¯•æµç¨‹

1. **å¼€å‘é˜¶æ®µ**: è¿è¡Œ `python test_all_business_logic.py` å¿«é€ŸéªŒè¯
2. **é›†æˆæµ‹è¯•**: å¯åŠ¨æœåŠ¡å™¨å¹¶è¿è¡Œ `python test_api_endpoints.py`
3. **åŠŸèƒ½æ¼”ç¤º**: ä½¿ç”¨curlå‘½ä»¤æ‰‹åŠ¨æµ‹è¯•å…³é”®æµç¨‹
4. **æŒç»­é›†æˆ**: åœ¨CI/CDä¸­è¿è¡Œä¸šåŠ¡é€»è¾‘æµ‹è¯•

### æµ‹è¯•è¦†ç›–ç‡

âœ… **è®¤è¯** - 7ä¸ªæµ‹è¯•  
âœ… **èˆªç­ç›®å½•** - 7ä¸ªæµ‹è¯•  
âœ… **é¢„è®¢ç®¡ç†** - 8ä¸ªæµ‹è¯•  
âœ… **æ”¯ä»˜å¤„ç†** - 5ä¸ªæµ‹è¯•  
âœ… **ä¼šå‘˜ç§¯åˆ†** - 6ä¸ªæµ‹è¯•  
âœ… **å®Œæ•´æµç¨‹** - 2ä¸ªæµ‹è¯•  
âœ… **é”™è¯¯å¤„ç†** - 6ä¸ªæµ‹è¯•  

**æ€»è®¡: 41ä¸ªä¸šåŠ¡é€»è¾‘æµ‹è¯• + 28ä¸ªAPIæµ‹è¯• = 69ä¸ªæµ‹è¯•ç”¨ä¾‹**

---

## ğŸ“š æ›´å¤šä¿¡æ¯

- **è¯¦ç»†æµ‹è¯•æŒ‡å—**: `æµ‹è¯•æŒ‡å—.md`
- **APIæ–‡æ¡£**: å¯åŠ¨æœåŠ¡å™¨åè®¿é—® `http://localhost:5000/api`
- **é¡¹ç›®README**: `README.md`

å¼€å§‹æµ‹è¯•: `python test_all_business_logic.py` ğŸš€


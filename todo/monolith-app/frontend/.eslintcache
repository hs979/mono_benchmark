[{"D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\index.js":"1","D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\App.js":"2","D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\serviceWorker.js":"3","D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\config.js":"4","D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\ToDo.js":"5"},{"size":512,"mtime":1762692108473,"results":"6","hashOfConfig":"7"},{"size":11966,"mtime":1762692110169,"results":"8","hashOfConfig":"7"},{"size":5088,"mtime":1762692108499,"results":"9","hashOfConfig":"7"},{"size":192,"mtime":1762692110169,"results":"10","hashOfConfig":"7"},{"size":2657,"mtime":1762692108499,"results":"11","hashOfConfig":"7"},{"filePath":"12","messages":"13","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"1u1a06j",{"filePath":"14","messages":"15","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"16"},{"filePath":"17","messages":"18","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"19","messages":"20","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"21","messages":"22","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\index.js",[],"D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\App.js",["23"],"/**\r\n * Todo应用主组件\r\n * \r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Container, Jumbotron, Row, Col, Alert, Button, Form, FormGroup, Label, Input } from 'reactstrap';\r\nimport axios from 'axios';\r\nimport ToDo from './ToDo'\r\n\r\nimport './App.css';\r\nimport logo from './aws.png';\r\n\r\nimport config from './config';\r\n\r\nfunction App() {\r\n  const [alert, setAlert] = useState();\r\n  const [alertStyle, setAlertStyle] = useState('info');\r\n  const [alertVisible, setAlertVisible] = useState(false);\r\n  const [alertDismissable, setAlertDismissable] = useState(false);\r\n  const [token, setToken] = useState('');\r\n  const [username, setUsername] = useState('');\r\n  const [toDos, setToDos] = useState([]);\r\n  const [isLogin, setIsLogin] = useState(true); // true为登录模式，false为注册模式\r\n\r\n  // 表单输入状态\r\n  const [formUsername, setFormUsername] = useState('');\r\n  const [formPassword, setFormPassword] = useState('');\r\n  const [formEmail, setFormEmail] = useState('');\r\n\r\n  // 从localStorage恢复登录状态\r\n  useEffect(() => {\r\n    const savedToken = localStorage.getItem('token');\r\n    const savedUsername = localStorage.getItem('username');\r\n    if (savedToken && savedUsername) {\r\n      setToken(savedToken);\r\n      setUsername(savedUsername);\r\n    }\r\n  }, []);\r\n\r\n  // 当token变化时，获取待办事项列表\r\n  useEffect(() => {\r\n    if (token && username) {\r\n      getAllTodos();\r\n    }\r\n  }, [token, username]);\r\n\r\n  // 配置axios拦截器，处理认证错误\r\n  axios.interceptors.response.use(\r\n    response => {\r\n      return response;\r\n    },\r\n    error => {\r\n      if (error.response && error.response.status === 401) {\r\n        // 认证失败，清除登录状态\r\n        handleLogout();\r\n        updateAlert({\r\n          alert: '登录已过期，请重新登录',\r\n          style: 'warning',\r\n          visible: true,\r\n          dismissable: true\r\n        });\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n\r\n  function onDismiss() {\r\n    setAlertVisible(false);\r\n  }\r\n\r\n  function updateAlert({ alert, style, visible, dismissable }) {\r\n    setAlert(alert ? alert : '');\r\n    setAlertStyle(style ? style : 'info');\r\n    setAlertVisible(visible);\r\n    setAlertDismissable(dismissable ? dismissable : null);\r\n  }\r\n\r\n  /**\r\n   * 用户登录\r\n   */\r\n  const handleLogin = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!formUsername || !formPassword) {\r\n      updateAlert({\r\n        alert: '请输入用户名和密码',\r\n        style: 'warning',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await axios.post('http://localhost:8080/auth/login', {\r\n        username: formUsername,\r\n        password: formPassword\r\n      });\r\n\r\n      if (result.status === 200) {\r\n        const { token, username } = result.data;\r\n        \r\n        // 保存到state和localStorage\r\n        setToken(token);\r\n        setUsername(username);\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('username', username);\r\n\r\n        // 清空表单\r\n        setFormUsername('');\r\n        setFormPassword('');\r\n\r\n        updateAlert({\r\n          alert: '登录成功！',\r\n          style: 'success',\r\n          visible: true,\r\n          dismissable: true\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('登录失败:', error);\r\n      updateAlert({\r\n        alert: error.response?.data?.message || '登录失败，请检查用户名和密码',\r\n        style: 'danger',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 用户注册\r\n   */\r\n  const handleRegister = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!formUsername || !formPassword) {\r\n      updateAlert({\r\n        alert: '请输入用户名和密码',\r\n        style: 'warning',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (formPassword.length < 6) {\r\n      updateAlert({\r\n        alert: '密码长度至少为6个字符',\r\n        style: 'warning',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await axios.post('http://localhost:8080/auth/register', {\r\n        username: formUsername,\r\n        password: formPassword,\r\n        email: formEmail\r\n      });\r\n\r\n      if (result.status === 201) {\r\n        const { token, username } = result.data;\r\n        \r\n        // 保存到state和localStorage\r\n        setToken(token);\r\n        setUsername(username);\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('username', username);\r\n\r\n        // 清空表单\r\n        setFormUsername('');\r\n        setFormPassword('');\r\n        setFormEmail('');\r\n\r\n        updateAlert({\r\n          alert: '注册成功！',\r\n          style: 'success',\r\n          visible: true,\r\n          dismissable: true\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('注册失败:', error);\r\n      updateAlert({\r\n        alert: error.response?.data?.message || '注册失败，请稍后重试',\r\n        style: 'danger',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 用户登出\r\n   */\r\n  const handleLogout = () => {\r\n    setToken('');\r\n    setUsername('');\r\n    setToDos([]);\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('username');\r\n  };\r\n\r\n  /**\r\n   * 获取所有待办事项\r\n   */\r\n  const getAllTodos = async () => {\r\n    try {\r\n      const result = await axios({\r\n        url: `${config.api_base_url}/item/`,\r\n        headers: {\r\n          Authorization: token\r\n        }\r\n      });\r\n\r\n      if (result && result.status === 200) {\r\n        setToDos(result.data.Items || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('获取待办事项失败:', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 添加待办事项\r\n   */\r\n  const addToDo = async (event) => {\r\n    const newToDoInput = document.getElementById('newToDo');\r\n    const item = newToDoInput.value;\r\n    \r\n    if (!item || item === '') return;\r\n\r\n    const newToDo = {\r\n      \"item\": item,\r\n      \"completed\": false\r\n    };\r\n\r\n    try {\r\n      const result = await axios({\r\n        method: 'POST',\r\n        url: `${config.api_base_url}/item/`,\r\n        headers: {\r\n          Authorization: token\r\n        },\r\n        data: newToDo\r\n      });\r\n\r\n      if (result && result.status === 200) {\r\n        getAllTodos();\r\n        newToDoInput.value = '';\r\n      }\r\n    } catch (error) {\r\n      console.error('添加待办事项失败:', error);\r\n      updateAlert({\r\n        alert: '添加失败，请重试',\r\n        style: 'danger',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 删除待办事项\r\n   */\r\n  const deleteToDo = async (indexToRemove, itemId) => {\r\n    if (indexToRemove === null || itemId === null) return;\r\n\r\n    try {\r\n      const result = await axios({\r\n        method: 'DELETE',\r\n        url: `${config.api_base_url}/item/${itemId}`,\r\n        headers: {\r\n          Authorization: token\r\n        }\r\n      });\r\n\r\n      if (result && result.status === 200) {\r\n        const newToDos = toDos.filter((item, index) => index !== indexToRemove);\r\n        setToDos(newToDos);\r\n      }\r\n    } catch (error) {\r\n      console.error('删除待办事项失败:', error);\r\n      updateAlert({\r\n        alert: '删除失败，请重试',\r\n        style: 'danger',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 标记待办事项为完成\r\n   */\r\n  const completeToDo = async (itemId) => {\r\n    if (itemId === null) return;\r\n\r\n    try {\r\n      const result = await axios({\r\n        method: 'POST',\r\n        url: `${config.api_base_url}/item/${itemId}/done`,\r\n        headers: {\r\n          Authorization: token\r\n        }\r\n      });\r\n\r\n      if (result && result.status === 200) {\r\n        getAllTodos();\r\n      }\r\n    } catch (error) {\r\n      console.error('标记完成失败:', error);\r\n      updateAlert({\r\n        alert: '操作失败，请重试',\r\n        style: 'danger',\r\n        visible: true,\r\n        dismissable: true\r\n      });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <Container>\r\n        <Alert color={alertStyle} isOpen={alertVisible} toggle={alertDismissable ? onDismiss : null}>\r\n          <p dangerouslySetInnerHTML={{ __html: alert }}></p>\r\n        </Alert>\r\n        <Jumbotron>\r\n          <Row>\r\n            <Col md=\"6\" className=\"logo\">\r\n              <h1>Todo应用</h1>\r\n              <p>这是一个传统的单体Web应用。</p>\r\n              <p>使用Node.js + Express作为后端，React作为前端，DynamoDB作为数据库。采用JWT进行用户身份认证。</p>\r\n              <img src={logo} alt=\"Logo\" />\r\n            </Col>\r\n            <Col md=\"6\">\r\n              {token && username ? (\r\n                <div>\r\n                  <div className=\"user-info\">\r\n                    <p>欢迎回来，<strong>{username}</strong>！</p>\r\n                    <Button color=\"secondary\" size=\"sm\" onClick={handleLogout} className=\"logout-btn\">\r\n                      退出登录\r\n                    </Button>\r\n                  </div>\r\n                  <ToDo \r\n                    updateAlert={updateAlert} \r\n                    toDos={toDos} \r\n                    addToDo={addToDo} \r\n                    deleteToDo={deleteToDo} \r\n                    completeToDo={completeToDo} \r\n                  />\r\n                </div>\r\n              ) : (\r\n                <div className=\"auth-form\">\r\n                  <h3>{isLogin ? '登录' : '注册'}</h3>\r\n                  <Form onSubmit={isLogin ? handleLogin : handleRegister}>\r\n                    <FormGroup>\r\n                      <Label for=\"username\">用户名</Label>\r\n                      <Input\r\n                        type=\"text\"\r\n                        name=\"username\"\r\n                        id=\"username\"\r\n                        placeholder=\"请输入用户名\"\r\n                        value={formUsername}\r\n                        onChange={(e) => setFormUsername(e.target.value)}\r\n                        required\r\n                      />\r\n                    </FormGroup>\r\n                    <FormGroup>\r\n                      <Label for=\"password\">密码</Label>\r\n                      <Input\r\n                        type=\"password\"\r\n                        name=\"password\"\r\n                        id=\"password\"\r\n                        placeholder=\"请输入密码（至少6位）\"\r\n                        value={formPassword}\r\n                        onChange={(e) => setFormPassword(e.target.value)}\r\n                        required\r\n                      />\r\n                    </FormGroup>\r\n                    {!isLogin && (\r\n                      <FormGroup>\r\n                        <Label for=\"email\">邮箱（可选）</Label>\r\n                        <Input\r\n                          type=\"email\"\r\n                          name=\"email\"\r\n                          id=\"email\"\r\n                          placeholder=\"请输入邮箱\"\r\n                          value={formEmail}\r\n                          onChange={(e) => setFormEmail(e.target.value)}\r\n                        />\r\n                      </FormGroup>\r\n                    )}\r\n                    <Button color=\"primary\" type=\"submit\" block>\r\n                      {isLogin ? '登录' : '注册'}\r\n                    </Button>\r\n                  </Form>\r\n                  <div className=\"auth-toggle\">\r\n                    <button onClick={() => setIsLogin(!isLogin)}>\r\n                      {isLogin ? '还没有账号？点击注册' : '已有账号？点击登录'}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </Col>\r\n          </Row>\r\n        </Jumbotron>\r\n      </Container>\r\n    </div >\r\n  );\r\n}\r\n\r\nexport default App;\r\n\r\n","D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\serviceWorker.js",[],"D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\config.js",[],"D:\\科研\\云应用转换\\mono-sls-dataset\\aws-samples\\todo\\monolith-app\\frontend\\src\\ToDo.js",[],{"ruleId":"24","severity":1,"message":"25","line":46,"column":6,"nodeType":"26","endLine":46,"endColumn":23,"suggestions":"27"},"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'getAllTodos'. Either include it or remove the dependency array.","ArrayExpression",["28"],{"desc":"29","fix":"30"},"Update the dependencies array to be: [getAllTodos, token, username]",{"range":"31","text":"32"},[1368,1385],"[getAllTodos, token, username]"]